# Render Deployment Template
#
# Setup Instructions:
# 1. Rename this file: deploy-render.yml.template â†’ deploy-render.yml
# 2. Add GitHub Secrets:
#    - RENDER_API_KEY: Render API key (https://dashboard.render.com/account/api-keys)
#    - RENDER_SERVICE_ID: Render service ID
# 3. Adjust branch triggers as needed (main, develop, etc.)
#
# Note: Render also supports auto-deployment via Dashboard.
# This workflow is for manual control via GitHub Actions.

name: Deploy to Render

on:
  push:
    branches:
      - main          # Production deployment
      # - develop     # Staging deployment (uncomment if using Pattern A)
  pull_request:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Trigger Render Deployment
        env:
          RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
          RENDER_SERVICE_ID: ${{ secrets.RENDER_SERVICE_ID }}
        run: |
          curl -X POST "https://api.render.com/v1/services/$RENDER_SERVICE_ID/deploys" \
            -H "Authorization: Bearer $RENDER_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{"clearCache": false}'

      - name: Wait for Deployment
        run: |
          echo "Waiting for deployment to complete..."
          sleep 60

      - name: Health Check
        if: github.ref == 'refs/heads/main'
        run: |
          curl -f https://{{YOUR_DOMAIN}}.onrender.com/health || exit 1
