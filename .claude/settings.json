{
  "$schema": "https://claude.com/schemas/settings.json",
  "description": "Claude Codeè¨­å®š - Permissions & Hooks",

  "permissions": {
    "defaultMode": "allow",
    "allowScopes": [
      "Read:**/*",
      "Edit:**/*.{tsx,ts,py,md,json}",
      "Write:**/*.{tsx,ts,py,md,json}",
      "Glob:**",
      "Grep:**",
      "Task:*",
      "Bash:git*",
      "Bash:npm*",
      "Bash:docker*",
      "mcp__github__*",
      "mcp__serena__*",
      "mcp__playwright__*",
      "mcp__supabase__*",
      "mcp__desktop-commander__*",
      "mcp__context7__*"
    ],
    "denyScopes": [
      "Bash:rm -rf /*",
      "Bash:git push --force main",
      "Bash:git reset --hard HEAD~*",
      "Write:.env*",
      "Edit:.env*"
    ]
  },

  "hooks": {
    "preToolUse": [
      {
        "name": "prevent-main-branch-direct-commit",
        "description": "mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ç›´æ¥ã‚³ãƒŸãƒƒãƒˆé˜²æ­¢",
        "matcher": {
          "toolName": "Bash",
          "argsPattern": "git commit.*"
        },
        "action": {
          "type": "block",
          "message": "âŒ mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ç›´æ¥ã‚³ãƒŸãƒƒãƒˆã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™"
        }
      },
      {
        "name": "pre-commit-quality-check",
        "description": "ã‚³ãƒŸãƒƒãƒˆå‰ã®å“è³ªãƒã‚§ãƒƒã‚¯æ¨å¥¨ï¼ˆAuto-Fixä»˜ãï¼‰",
        "matcher": {
          "toolName": "Bash",
          "argsPattern": "git commit -m \"(?!test:|docs:).*\""
        },
        "action": {
          "type": "suggest",
          "message": "ğŸ’¡ ã‚³ãƒŸãƒƒãƒˆå‰ã« /pre-commit-check å®Ÿè¡Œã‚’æ¨å¥¨\n\nã€Claude Agentå‘ã‘ã€‘\nè‡ªå‹•ã§ /pre-commit-check ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ git commit ã—ã¦ãã ã•ã„\n\nã€Auto-Fixæ©Ÿèƒ½ã€‘\n- Critical: 7å›ç›®ã§ç›¸è«‡ã€æœ€å¤§10å›\n- High: 3å›ã¾ã§ï¼ˆæœªè§£æ±ºãªã‚‰Technical Debtç™»éŒ²ï¼‰\n- Medium: 1å›ã®ã¿\n\nã€ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ã€‘\n- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®ã¿\n- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ï¼ˆtest:ï¼‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆdocs:ï¼‰ã¯è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—\n\nã€Technical Debtã€‘\næœªè§£æ±ºå•é¡Œ: reports/technical-debt.md"
        }
      }
    ],
    "postToolUse": [
      {
        "name": "auto-test-suggestion",
        "description": "å®Ÿè£…å¾Œã®ãƒ†ã‚¹ãƒˆæ¨å¥¨",
        "matcher": {
          "toolName": "Write",
          "argsPattern": "**/app/**/*.{ts,tsx,py}"
        },
        "action": {
          "type": "suggest",
          "message": "ğŸ’¡ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’æ¨å¥¨: Task:qa-unit ã¾ãŸã¯ /e2e-full"
        }
      }
    ],
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "powershell -c \"[console]::beep(600,150); Start-Sleep -Milliseconds 50; [console]::beep(800,150); Start-Sleep -Milliseconds 50; [console]::beep(1000,200)\""
          }
        ]
      }
    ]
  },

  "stopConditions": [
    {
      "name": "critical-test-failure",
      "description": "é‡å¤§ãªãƒ†ã‚¹ãƒˆå¤±æ•—ã§è‡ªå‹•åœæ­¢",
      "threshold": 10,
      "action": {
        "type": "halt",
        "message": "ğŸ›‘ E2Eãƒ†ã‚¹ãƒˆ10ä»¶ä»¥ä¸Šå¤±æ•—ã€‚ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚"
      }
    },
    {
      "name": "identical-error-streak",
      "description": "åŒä¸€ã‚¨ãƒ©ãƒ¼ãŒ3é€£ç¶š",
      "threshold": 3,
      "action": {
        "type": "halt",
        "message": "ğŸ›‘ åŒã˜ã‚¨ãƒ©ãƒ¼ãŒ3å›é€£ç¶šã—ã¾ã—ãŸã€‚HEALINGé–‹å§‹ã€‚"
      }
    },
    {
      "name": "high-failure-rate",
      "description": "å¤±æ•—ç‡30%è¶…",
      "window": 10,
      "threshold": 0.3,
      "action": {
        "type": "halt",
        "message": "ğŸ›‘ ç›´è¿‘10ã‚±ãƒ¼ã‚¹ã§å¤±æ•—ç‡30%è¶…ã€‚HEALINGé–‹å§‹ã€‚"
      }
    },
    {
      "name": "timeout-cascade",
      "description": "ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆé€£é–",
      "pattern": "waitForURL|waitForSelector",
      "count": 5,
      "window": "3min",
      "action": {
        "type": "halt",
        "message": "ğŸ›‘ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒ5å›/3åˆ†ç™ºç”Ÿã€‚HEALINGé–‹å§‹ã€‚"
      }
    },
    {
      "name": "spec-total-failure",
      "description": "specå…¨æ»…",
      "failureRate": 0.8,
      "minTests": 5,
      "action": {
        "type": "halt",
        "message": "ğŸ›‘ 1ã¤ã®specã§80%ä»¥ä¸Šå¤±æ•—ã€‚QUARANTINEé–‹å§‹ã€‚"
      }
    }
  ],

  "agents": [
    {
      "name": "project-planner",
      "role": "å…¨ä½“è¨­è¨ˆãƒ»Epicåˆ†è§£ãƒ»ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ç®¡ç†",
      "scope": [".serena/memories/project/epics/*.md"],
      "dependsOn": []
    },
    {
      "name": "sub-planner",
      "role": "æ©Ÿèƒ½è©³ç´°ãƒ»DoDãƒ»APIå¥‘ç´„å®šç¾©",
      "scope": [".serena/memories/project/tasks/*.md"],
      "dependsOn": ["project-planner"]
    },
    {
      "name": "impl-dev-frontend",
      "role": "UI/UXå®Ÿè£…ï¼ˆReact/Next.jsï¼‰",
      "scope": ["frontend/src/**", "frontend/components/**", "frontend/app/**"],
      "dependsOn": ["sub-planner"]
    },
    {
      "name": "impl-dev-backend",
      "role": "API/DBå®Ÿè£…ï¼ˆFastAPI/Supabaseï¼‰",
      "scope": ["backend/app/**"],
      "dependsOn": ["sub-planner"]
    },
    {
      "name": "integrator",
      "role": "FE/BEæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå‹å®šç¾©åŒæœŸï¼‰",
      "scope": ["frontend/src/types/**", "backend/app/schemas/**"],
      "dependsOn": ["impl-dev-frontend", "impl-dev-backend"]
    },
    {
      "name": "qa-unit",
      "role": "ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆpytest/Jestï¼‰",
      "scope": ["backend/tests/unit/**", "frontend/src/**/*.test.ts"],
      "dependsOn": ["impl-dev-frontend", "impl-dev-backend"]
    },
    {
      "name": "qa-integration",
      "role": "çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆAPIçµ±åˆãƒ»DBãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰",
      "scope": ["backend/tests/integration/**"],
      "dependsOn": ["integrator"]
    },
    {
      "name": "playwright-test-planner",
      "role": "E2Eæ¢ç´¢ãƒ»ãƒ†ã‚¹ãƒˆè¨ˆç”»ä½œæˆ",
      "scope": ["frontend/specs/*.md"],
      "dependsOn": ["integrator"]
    },
    {
      "name": "playwright-test-generator",
      "role": "ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆ",
      "scope": ["frontend/e2e/*.spec.ts", "frontend/e2e/pages/*.ts"],
      "dependsOn": ["playwright-test-planner"]
    },
    {
      "name": "playwright-test-healer",
      "role": "è‡ªå·±ä¿®å¾© + AIè‡ªå¾‹å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ",
      "scope": ["frontend/e2e/*.spec.ts", ".serena/memories/testing/**"],
      "dependsOn": ["playwright-test-generator"]
    },
    {
      "name": "lint-fix",
      "role": "Lint/ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆESLint/Prettier/Black/Ruffï¼‰",
      "scope": ["å¤‰æ›´æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿"],
      "dependsOn": []
    },
    {
      "name": "sec-scan",
      "role": "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆè„†å¼±æ€§æ¤œå‡ºï¼‰",
      "scope": ["reports/security-scan.md"],
      "dependsOn": []
    },
    {
      "name": "doc-writer",
      "role": "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆå·®åˆ†ãƒ™ãƒ¼ã‚¹ï¼‰",
      "scope": ["docs/**", "README.md", ".serena/memories/**"],
      "dependsOn": ["integrator", "playwright-test-healer"]
    },
    {
      "name": "release-manager",
      "role": "CHANGELOG/ã‚¿ã‚°ç”Ÿæˆãƒ»ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆä½œæˆ",
      "scope": ["CHANGELOG.md"],
      "dependsOn": ["doc-writer"]
    }
  ]
}
